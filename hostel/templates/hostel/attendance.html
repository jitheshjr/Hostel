{% extends 'hostel/base.html' %}

{% load static %}

{% block title %}
Hostel | AttendanceForm
{% endblock %}

{% block style %}
<link rel="stylesheet" href="{% static 'styles/attendance.css' %}">
{% endblock %}

{% block content %}
<section class="main">
    <div class="main-body">
        <div class="attendance-form">
            <div class="form-title">
                <a href="{% url 'home' %}" class="icon-close" title="Back to Home">
                    <i class="fas fa-arrow-left"></i>
                </a>
                
                <h5>Attendance Form</h5>
            </div>

            {% if messages %}
                <ul class="messages">
                    {% for message in messages %}
                        <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}

            <input type="text" id="studentSearch" placeholder="Search by name" onkeyup="filterStudents()">

            <form action="" method="post">
                {% csrf_token %}
                <label for="{{form.date.id_for_label}}">Date:</label>
                {{ form.date }}

                <label id="selectall_label">
                    <input type="checkbox" id="select_all"> Select all
                </label>

                <!-- Scrollable student list -->
                <div id="student-container">
                    {% for checkbox in form.absentees %}
                        <div class="student-item">
                            {{ checkbox }}
                        </div>
                    {% endfor %}
                </div>

                <input type="submit" value="Submit" class="submit-btn">
            </form>
        </div>
    </div>
</section>

    <script>
        function filterStudents() {
          let input = document.getElementById('studentSearch');
          let filter = input.value.toLowerCase();
          let studentContainer = document.getElementById('student-container');
          let students = Array.from(studentContainer.getElementsByTagName('label'));  // Convert HTMLCollection to array

          // Separate the matching and non-matching students
          let matchingStudents = [];
          let nonMatchingStudents = [];

          students.forEach(function(label) {
              let text = label.textContent || label.innerText;

              // If the text matches the filter, add to matchingStudents, else to nonMatchingStudents
              if (text.toLowerCase().includes(filter)) {
                  matchingStudents.push(label);
              } else {
                  nonMatchingStudents.push(label);
              }
          });

          // Clear the container and add matching students first, then non-matching students
          studentContainer.innerHTML = '';

          // Append matching students first
          matchingStudents.forEach(function(label) {
              studentContainer.appendChild(label);
          });

          // Append non-matching students (these will remain hidden)
          nonMatchingStudents.forEach(function(label) {
              studentContainer.appendChild(label);
          });

          // Hide non-matching students
          nonMatchingStudents.forEach(function(label) {
              label.style.display = 'none';
          });

          // Show matching students
          matchingStudents.forEach(function(label) {
              label.style.display = '';
          });
        }

        document.addEventListener("DOMContentLoaded", function() {
            const selectAllCheckbox = document.getElementById('select_all');
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');

            selectAllCheckbox.addEventListener('change', function() {
                checkboxes.forEach(checkbox => {
                    if (checkbox !== selectAllCheckbox) {
                        checkbox.checked = selectAllCheckbox.checked;
                    }
                });
            });
        });
    </script>
{% endblock %}
